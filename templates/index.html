<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Albion Party Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #1a1a1a; color: #e0e0e0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card-party { background-color: #2c2c2c; border-left: 5px solid #d4af37; margin-bottom: 20px; transition: 0.3s; }
        .card-party:hover { transform: scale(1.01); }
        .badge-role { background-color: #444; color: #ffcc00; margin-right: 5px; border: 1px solid #d4af37; }
        .leader-name { color: #00d4ff; font-weight: bold; }
        .abandonos { color: #ff4444; font-size: 0.9em; }
        header { background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://assets.albiononline.com/assets/images/og_image.jpg'); background-size: cover; padding: 40px 0; border-bottom: 3px solid #d4af37; text-align: center; }
    </style>
</head>
<body>
<div class="row mt-5">
    <div class="col-12 d-flex justify-content-between align-items-center mb-3">
        <h3 style="color: #ffaa00;">üìã Plantillas del Gremio</h3>
        <button class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" data-bs-target="#templateModal">
            + Nueva Plantilla
        </button>
    </div>

    {% for temp in templates %}
    <div class="col-md-4 mb-3">
        <div class="card bg-dark border-secondary text-white p-3">
            <h5 class="text-warning">{{ temp.nombre }}</h5>
            <ul class="small list-unstyled">
                {% for role, cant in temp.roles.items() %}
                <li><span class="text-muted">‚Ä¢</span> {{ role }}: {{ cant }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% else %}
    <p class="text-muted">No hay plantillas personalizadas. ¬°Crea la primera!</p>
    {% endfor %}
</div>

<div class="modal fade" id="templateModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white border-warning">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">Crear Nueva Plantilla</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form action="/create_template/{{ guild_id }}" method="POST">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Nombre de la Plantilla</label>
                        <input type="text" name="nombre" class="form-control bg-secondary text-white border-0" placeholder="Ej: ZVZ Peque√±a" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Definici√≥n de Roles (Separados por comas)</label>
                        <textarea name="roles" class="form-control bg-secondary text-white border-0" rows="3" placeholder="Tanque:1, Healer:2, DPS:5" required></textarea>
                        <div class="form-text text-muted">Sigue el formato: Nombre:Cantidad, Nombre:Cantidad</div>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="submit" class="btn btn-warning">Guardar Plantilla</button>
                </div>
            </form>
        </div>
    </div>
</div>
<header>
    <h1 class="display-4 fw-bold text-uppercase" style="color: #d4af37;">Panel de Actividades</h1>
    <p class="lead">Estado de las Parties en Tiempo Real</p>
</header>

<div class="container mt-5">
    {% if not parties %}
        <div class="alert alert-info text-center bg-dark text-light border-secondary">
            ‚öîÔ∏è No hay actividades activas en este momento.
        </div>
    {% endif %}

    <div class="row">
        {% for party in parties %}
        <div class="col-md-6">
            <div class="card card-party shadow-lg">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="card-title h4">üõ°Ô∏è {{ party.titulo }}</h3>
                        <span class="badge bg-warning text-dark">{{ party.createdAt.strftime('%H:%M') if party.createdAt else '--:--' }} UTC</span>
                    </div>
                    <p class="text-muted small mb-2">{{ party.descripcion }}</p>
                    <hr class="border-secondary">
                    
                    <div class="mb-3">
                        <span class="leader-name">üëë L√≠der:</span> <span class="text-light">Jugador ID: {{ party.creador }}</span>
                    </div>

                    <div class="row g-2">
                        {% for rol, lista in party.participants.items() %}
                        <div class="col-6">
                            <div class="p-2 border border-secondary rounded bg-dark">
                                <strong class="small text-uppercase">{{ rol }}</strong>
                                <div class="small">
                                    {% if lista %}
                                        {{ lista|length }} / {{ party.limites[rol] }}
                                    {% else %}
                                        <span class="text-muted small">Vaciado</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    {% if party.abandonos %}
                    <div class="mt-3">
                        <h6 class="text-danger small fw-bold text-uppercase">üèÉ Abandonos Recientes:</h6>
                        <ul class="list-unstyled abandonos ps-2">
                            {% for abandono in party.abandonos %}
                                <li>{{ abandono }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<footer class="text-center mt-5 py-4 text-muted border-top border-secondary">
    Dashboard vinculado a MongoDB - Albion Online Guild Management
</footer>

</body>
</html>